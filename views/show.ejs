<%- include("partials/header") %>
<div class="container mt-3">
    <div class="row">
        <div class="col-md-4">
            
            <p class="lead text-center"><strong><%= bar.name %></strong></p>
            
            <div id="highlights" class="card shadow-sm mb-4 text-center">
                <div class="card-header bg-info text-white">
                    <i class="fas fa-thumbtack mr-2"></i>Highlights
                </div>
                <ul class="list-group list-group-flush">
                    <li class="list-group-item text-capitalize">20th floor</li>
                    <li class="list-group-item text-capitalize">breathtaking views</li>
                </ul>
            </div>
            
            <div class="card shadow-sm mb-3">
                <ul class="list-group list-group-flush">
                    <li id="view" class="list-group-item text-capitalize bg-light">
                        <div class="row">
                            <div class="col-3">
                                <i class="fas fa-eye"></i>
                            </div>
                            <div class="col-9">Skyline, City view</div>
                        </div>
                    </li>
                    
                    <li id="food" class="list-group-item text-capitalize bg-light">
                        <div class="row">
                            <div class="col-3">
                                <i class="fas fa-utensils"></i>
                            </div>
                            <div class="col-9">Bar bites & snacks</div>
                        </div>
                    </li>
                </ul>
            </div>
            
            <div class="card shadow-sm mb-4">
                <div id="map">
                </div>
                <ul class="list-group list-group-flush">
                    <li class="list-group-item text-capitalize">
                        <i class="fas fa-map-marker-alt mr-2"></i>
                        <%= bar.location %>
                    </li>
                </ul>
            </div>
        </div>
    


        <!-- MAIN CONTENT -->
        
        <div class="col-md-8">
            <div class="card shadow-sm">
                <img id="show-img" class="card img-top img-fluid" src="<%= bar.image %>">
                <div class="card-body">
                    <div id="dollarSign" class="float-right text-success">
                        <strong><%= bar.price %></strong>
                    </div>
                    <h5 class="card-title text-info"><%= bar.name %></h5>
                    <p class="card-text"><%= bar.desc %></p>
                    <hr>
                    <p class="text-muted"> <em>Contributed by 
                        <span class="font-weight-bold">
                            <%= bar.author.username %>
                        </span>
                        </em>
                        
                        <a class="btn btn-success btn-sm float-right" href="/bars/new">
                            <i class="fas fa-plus mr-2"></i> Add New Bar
                        </a>
                    </p>
                    <% if (currentUser && bar.author.id.equals(currentUser.id)) {%>
                        <a href="/bars/<%= bar.id %>/edit" class="btn btn-warning btn-sm">Edit</a>            
                        <button class="btn btn-danger btn-sm" data-toggle="modal" data-target="#deleteWarning">Delete</button>

                    <div class="modal fade" id="deleteWarning" tabindex="-1" role="dialog" aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <p class="modal-title" id="exampleModalLongTitle">
                                        <strong>Confirm Deletion</strong>
                                    </p>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body text-center">
                                    Are you sure you want to delete this rooftop bar? 
                                </div>
                                <div class="modal-footer justify-content-center">
                                    <form id="delete-form" action="/bars/<%= bar.id %>?_method=DELETE" method="POST">
                                        <button class="btn btn-danger">Delete</button>
                                    </form>
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                                </div>
                            </div>
                        </div>
                    </div>                  
                    <% } %>
                </div>
            </div>
            <div class="card mt-3">
                <li class="card-body bg-light list-group-item">
                    <button class="btn btn-warning btn-sm float-right collapsed mb-2" data-toggle="collapse" data-target="#collapseComment" aria-expanded="false" aria-controls="collapseComment">
                        <i class="fas fa-comment-alt mr-2"></i>Review
                    </button>
                    <div class="collapse" id="collapseComment">
                        <form action="/bars/<%= bar.id %>/comments" method="POST">
                            <div class="form-group">
                                <textarea placeholder="What do you think about this rooftop bar?" name="comment[text]" class="form-control" rows="2" required></textarea>    
                            </div>
                            <button class="btn btn-success btn-sm left-floated">Send</button>
                            <hr>
                        </form>                        
                    </div>
                </li>
                    <% bar.comments.forEach(function(comment){ %>
                    
                        <li class="list-group-item">
                            <span>
                                <strong><%= comment.author.username %></strong>
                            </span>
                            <span class="float-right text-muted">10 days ago</span><br>
                            <span class="text-muted"><%= comment.text %></span>
                            <% if(currentUser && comment.author.id.equals(currentUser.id)) { %>
                                <div class="float-right">
                                    <a class="btn collapsed" data-toggle="collapse" data-target="#editComment<%=comment.id%>" aria-expanded="false" aria-controls="editComment<%=comment.id%>">
                                        <i class="fas fa-pen"></i>
                                    </a>
                                    <button class="btn" data-toggle="modal" data-target="#deleteCommentWarning">
                                            <i class="fas fa-trash-alt"></i>
                                    </button>
                                    <div class="modal fade" id="deleteCommentWarning" tabindex="-1" role="dialog" aria-hidden="true">
                                        <div class="modal-dialog modal-dialog-centered" role="document">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <p class="modal-title" id="exampleModalLongTitle">
                                                        <strong>Confirm Deletion</strong>
                                                    </p>
                                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                        <span aria-hidden="true">&times;</span>
                                                    </button>
                                                </div>
                                                <div class="modal-body text-center">
                                                    Are you sure you want to delete this review? 
                                                </div>
                                                <div class="modal-footer justify-content-center">
                                                    <form action="/bars/<%= bar.id %>/comments/<%= comment.id %>?_method=DELETE" method="POST" class="float-right">
                                                        <button class="btn btn-danger">Delete</button>
                                                    </form>
                                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div> 
                                    
                                </div>
                                <div class="collapse" id="editComment<%=comment.id%>">
                                    <form action="/bars/<%= bar.id %>/comments/<%= comment.id %>?_method=PUT" method="POST">
                                    <div class="form-group">
                                        <textarea name="comment[text]" class="form-control" rows="2"><%= comment.text %></textarea>
                                    </div>
                                    <button class="btn btn-warning btn-sm left-floated">Edit</button><br>
                                    </form>
                                </div>
                            <% }; %>
                        </li>
                    <% }) %>
              </div>
            </div>
        </div>
    </div>
</div>

<script>
  function initMap() {
    var lat = <%= bar.lat %>;
    var lng = <%= bar.lng %>;
    var center = {lat: lat, lng: lng };
    var map = new google.maps.Map(document.getElementById('map'), {
        zoom: 8,
        center: center,
        scrollwheel: false
    });
    var contentString = `
      <strong><%= bar.name %><br />
      <%= bar.location %></strong>
      <p><%= bar.description %></p>
    `
    var infowindow = new google.maps.InfoWindow({
      content: contentString
    });
    var marker = new google.maps.Marker({
        position: center,
        map: map
    });
    marker.addListener('click', function() {
      infowindow.open(map, marker);
    });
  }
</script>
<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD1VknrvkYLcBzSDW8VnHfnwPCLdTaJv7A&callback=initMap"></script>

<%- include("partials/footer") %>
